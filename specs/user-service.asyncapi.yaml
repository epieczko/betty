asyncapi: 3.0.0

info:
  title: UserService Events
  version: 1.0.0
  description: Event-driven API for user service lifecycle notifications

servers:
  production:
    host: kafka.company.com:9092
    protocol: kafka
    description: Production Kafka cluster

channels:
  user.created:
    address: user.created.v1
    messages:
      UserCreated:
        $ref: '#/components/messages/UserCreated'

  user.updated:
    address: user.updated.v1
    messages:
      UserUpdated:
        $ref: '#/components/messages/UserUpdated'

  user.deleted:
    address: user.deleted.v1
    messages:
      UserDeleted:
        $ref: '#/components/messages/UserDeleted'

operations:
  publishUserCreated:
    action: send
    channel:
      $ref: '#/channels/user.created'

  subscribeUserCreated:
    action: receive
    channel:
      $ref: '#/channels/user.created'

components:
  messages:
    UserCreated:
      name: UserCreated
      title: User Created Event
      contentType: application/json
      payload:
        $ref: '#/components/schemas/UserCreatedPayload'

    UserUpdated:
      name: UserUpdated
      title: User Updated Event
      contentType: application/json
      payload:
        $ref: '#/components/schemas/UserUpdatedPayload'

    UserDeleted:
      name: UserDeleted
      title: User Deleted Event
      contentType: application/json
      payload:
        $ref: '#/components/schemas/UserDeletedPayload'

  schemas:
    UserCreatedPayload:
      type: object
      required: [event_id, user_id, occurred_at]
      properties:
        event_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        occurred_at:
          type: string
          format: date-time

    UserUpdatedPayload:
      type: object
      required: [event_id, user_id, occurred_at, changes]
      properties:
        event_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        changes:
          type: object
        occurred_at:
          type: string
          format: date-time

    UserDeletedPayload:
      type: object
      required: [event_id, user_id, occurred_at]
      properties:
        event_id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        occurred_at:
          type: string
          format: date-time
